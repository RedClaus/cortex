#!/bin/bash
# Run tests before pushing to remote
# Skippable with: git push --no-verify

echo "ğŸ§ª Running pre-push checks..."

# Run dep-check (no illegal cross-app imports)
echo "  Checking dependency rules..."
if ! make -C "$(git rev-parse --show-toplevel)" dep-check 2>/dev/null; then
  echo "âŒ Dependency check failed. Fix illegal imports before pushing."
  exit 1
fi

echo "  Running tests..."
if ! make -C "$(git rev-parse --show-toplevel)" test 2>/dev/null; then
  echo "âŒ Tests failed. Fix before pushing."
  exit 1
fi

echo "âœ… All checks passed."
